{% extends "base.html" %}
{% block title %}Breaking â€” Hermes Radio{% endblock %}
{% block content %}
<h2>Breaking News</h2>

<article>
    <p>Trigger a breaking news interrupt. This will:</p>
    <ol>
        <li>Immediately inject a "Quick update" sting</li>
        <li>Generate a breaking news clip async</li>
        <li>Inject the clip when ready</li>
    </ol>

    <form id="breaking-form">
        <label>
            Note (optional context)
            <textarea name="note" rows="3" placeholder="What's the breaking news about?"></textarea>
        </label>
        <button type="submit" id="breaking-btn" class="contrast">Trigger Breaking</button>
    </form>

    <div id="result" class="mt-1"></div>
</article>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('breaking-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const note = e.target.note.value;
    const btn = document.getElementById('breaking-btn');
    const resultDiv = document.getElementById('result');

    btn.disabled = true;
    btn.ariaBusy = 'true';
    resultDiv.innerHTML = '<p>Triggering...</p>';

    try {
        const resp = await fetch('/api/breaking/trigger', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({reason: 'MANUAL', note})
        });
        const data = await resp.json();
        resultDiv.innerHTML = `<p>Status: <strong>${data.status}</strong></p>
            <p>Sting injected: ${data.sting_injected}</p>
            <p>Clip ETA: ~${data.clip_eta_seconds}s</p>`;
    } catch (err) {
        resultDiv.innerHTML = `<p class="text-danger">Error: ${err.message}</p>`;
    } finally {
        btn.disabled = false;
        btn.ariaBusy = 'false';
    }
});
</script>
{% endblock %}
